<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8>
  <title>PlotXYZ</title>
</head>
<body>

  <style>
    #map {
      width: 600px;
      height: 400px;
    }
  </style>

  <div id="map"></div>
</body>

<!-- Outside dependencies -->
<!-- Leaflet CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.2/leaflet.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.2/leaflet.css">

<!-- Example data extraction -->
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script src="extract.js"></script>

<!-- New library -->
<script src="hsv2rgb.js"></script>
<script src="plotXYZ.js"></script>

<!-- Three JS dependencies -->
<!-- <script src="three.js"></script> -->

<script>

// global
let plot;

runExtraction('data.csv')
.then((resp) => {

  const settings = {
    dimensions: {
      height: 50,
      width:  50
    }, 
    values: resp,
  };

  plot = new PlotXYZ(settings);

  // console.log('res', plot.getMatrix(100, 0));

  var map = L.map('map').setView([19.570851, -99.131513], 12);

  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}@2x.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
    maxZoom: 18,
    id: 'mapbox.light'
  }).addTo(map);
  
  var matrix = plot.getMatrix(100, 0.05);

  var maxVal = 0;
  // f.forEach((ea) => {
  //   console.log(ea)
  //   if (ea.properties.val > maxVal) maxVal = ea.properties.val;
  // });

  matrix.forEach((row) => {
    row.forEach((cell) => {
      if (cell.properties.val) {
        L.geoJSON(cell, {
          style: function (cell) {
            return {
              color: hsv2rgb(cell.properties.val * 20), // out of 100
              stroke: 0,
              fillOpacity: 0.8
            }
          }
        }).addTo(map)
      }
    });
  });

  // plot.getValues().forEach((ea) => {
  //   L.marker(ea).addTo(map)
  // })

});

</script>

</html>